    <main class="content center">
      <h2>Enter a username</h2>
      <form id="form" method="POST" action="/auth/username" class="center">
        <mdui-text-field
          type="text"
          id="username"
          name="username"
          autocomplete="username webauthn"
          label="username"
          autofocus></mdui-text-field>
        <input type="password" class="hidden" name="password" />
        <p class="instructions">Any username can be accepted.</p>
        <mdui-button type="submit">Next</mdui-button>
        <mdui-button href="/one-button" variant="text">Use one button sign-in instead</mdui-button>
        <ol class="instructions narrow">
          <li>Sign in with a random username and password.</li>
          <li>Create a passkey.</li>
          <li>Sign out.</li>
          <li>Click or tap on the username input field to show an autofill dialog.</li>
          <li>Select a passkey.</li>
          <li>Authenticate.</li>
          <li>You are signed in.</li>
        </ol>
      </form>
    </main>
    <script type="module">
      import { $, _fetch, loading, authenticate } from '/client.js';

      const form = $('#form');
      // When the form is submitted, proceed to the password form.
      form.addEventListener('submit', async s => {
        s.preventDefault();
        const form = new FormData(s.target);
        const cred = {};
        form.forEach((v, k) => cred[k] = v);
        _fetch(s.target.action, cred)
        .then(user => {
          location.href = '/reauth';
        }).catch(e => {
          loading.stop();
          console.error(e.message);
          alert(e);
        });
      });

      // Feature detection: check if WebAuthn and conditional UI are supported.
      if (window.PublicKeyCredential &&
          PublicKeyCredential.isConditionalMediationAvailable) {
        try {
          const cma= await PublicKeyCredential.isConditionalMediationAvailable();
          if (cma) {
            // If a conditional UI is supported, invoke the conditional `authenticate()` immediately.
            const user = await authenticate(true);
            if (user) {
              // When the user is signed in, redirect to the home page.
              $('#username').value = user.username;
              loading.start();
              location.href = '/home';
            } else {
              throw new Error('User not found.');
            }
          }
        } catch (e) {
          loading.stop();
          console.error(e);
          // `NotAllowedError` indicates a user cancellation.
          if (e.name !== 'NotAllowedError') {
            alert(e.message);
          }
        }
      }

    </script>